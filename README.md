# simulate-disconnect

**Git**

```
echo "# simulate-disconnect" >> README.md
git init
git add README.md
git commit -m "first commit"
git branch -M main
git remote add origin https://github.com/alpha-wolf-jin/simulate-disconnect.git
git config --global credential.helper 'cache --timeout 72000'
git push -u origin main

git add . ; git commit -a -m "update README" ; git push -u origin main

```
**Current Network Settings**
```
# oc describe network.config/cluster
Name:         cluster
Namespace:    
Kind:         Network
Spec:
  Cluster Network:
    Cidr:         10.128.0.0/14
    Host Prefix:  23
  External IP:
    Policy:
  Network Type:  OpenShiftSDN
  Service Network:
    172.30.0.0/16
Status:
  Cluster Network:
    Cidr:               10.128.0.0/14
    Host Prefix:        23
  Cluster Network MTU:  1450
  Network Type:         OpenShiftSDN
  Service Network:
    172.30.0.0/16
```

**DNS IP on node**
```
sh-4.4# cat /etc/resolv.conf 
# Generated by NetworkManager
search kiznb3lgbitelmvyuorbtnweaa.bx.internal.cloudapp.net
nameserver 168.63.129.16

sh-4.4# chroot /host
sh-4.4# cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
172.30.16.213 image-registry.openshift-image-registry.svc image-registry.openshift-image-registry.svc.cluster.local # openshift-generated-node-resolver
20.55.122.255 quay.example.opentlc.com
```

**DNS Setting**
```
@		NS	172800	ns1-02.azure-dns.com.

api.aro		A	60	52.186.41.77
*.apps.aro	A	300	20.81.59.208
```

```
[jinzhang@localhost ~]$ ping ns1-02.azure-dns.com
PING ns1-02.azure-dns.com (40.90.4.2) 56(84) bytes of data.
```

**Add the IP for egress allow for LB in specific project**
```
oc get svc -o wide | grep LoadBalancer
noobaa-mgmt                                       LoadBalancer   172.30.179.144   20.241.129.119   80:30323/TCP,443:31915/TCP,8445:31436/TCP,8446:32455/TCP   84m   noobaa-mgmt=noobaa
s3                                                LoadBalancer   172.30.29.5      20.124.55.244    80:31653/TCP,443:30543/TCP,8444:32275/TCP,7004:32073/TCP   84m   noobaa-s3=noobaa

```

```
# vim egress.yaml

apiVersion: network.openshift.io/v1
kind: EgressNetworkPolicy
metadata:
  name: default
spec:
  egress:
  - type: Allow
    to:
      cidrSelector: 172.30.0.0/16
  - type: Allow
    to:
      cidrSelector: 10.128.0.0/14
  - type: Allow
    to:
      cidrSelector: 20.241.130.172/32
  - type: Allow
    to:
      cidrSelector: 20.124.167.106/32
  - type: Allow
    to:
      cidrSelector: 20.55.122.255/32
  - type: Allow
    to:
      cidrSelector: 20.241.129.119/32
  - type: Allow
    to:
      cidrSelector: 20.124.55.244/32
  - type: Allow
    to:
      dnsName: quay.example.opentlc.com
  - type: Allow
    to:
      dnsName: api.aro.example.opentlc.com
  - type: Deny
    to:
      cidrSelector: 0.0.0.0/0


# oc apply -f egress.yaml -n openshift-storage

```
